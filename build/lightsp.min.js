var LightManager={create:function(options){var self=Object.create(this);return self.options=options,self._update=self.update.bind(self),self.then=0,self.fpsInterval=1e3/self.options.fps,self.rafId=0,self.children=[],self.options.stage.canvas.width=self.options.stage.width,self.options.stage.canvas.height=self.options.stage.height,self.ctx=self.options.stage.canvas.getContext("2d"),self},add:function(child){child.setContext(this.ctx),this.children.push(child)},remove:function(child){var index=this.children.indexOf(child);-1!==index&&this.children.splice(index,0)},setFPS:function(fps){this.fpsInterval=1e3/fps},setScale:function(scale){for(var length=this.children.length;length--;)this.children[length].scale=scale},start:function(){this.rafId=requestAnimationFrame(this._update)},stop:function(){cancelRequestAnimationFrame(this.rafId)},update:function(timestamp){var elapsed=timestamp-this.then;if(elapsed>this.fpsInterval){this.ctx.clearRect(0,0,this.options.stage.canvas.width,this.options.stage.canvas.height);for(var length=this.children.length;length--;)this.children[length].draw(timestamp);this.then=timestamp-elapsed%this.fpsInterval}requestAnimationFrame(this._update)}},LightSpritesheet={FORWARD:"direction.forward",REVERSE:"direction.reverse",create:function(options){var self=Object.create(this);return self.options=options,self.currentSpriteProps={iX:0,iY:0,x:0,y:0},self.currentFrame=0,self.spritesheet=new Image,self.spritesheet.onload=self.handleSpritesheetLoaded.bind(self),self.spritesheet.src=self.options.frames.src,self.direction=1,self.scale=1,self.x=self.options.x,self.y=self.options.y,self},setContext:function(ctx){this.ctx=ctx},draw:function(timestamp,ctx){1===this.direction&&this.currentFrame<this.options.frames.count-1||-1===this.direction&&this.currentFrame>0?this.currentFrame+=this.direction:this.options.loop&&(this.currentFrame=0,console.log("loop")),this.currentSpriteProps.iX=this.currentFrame%this.options.cols,this.currentSpriteProps.iY=Math.floor(this.currentFrame/this.options.cols),this.currentSpriteProps.x=this.currentSpriteProps.iX*this.options.frames.width,this.currentSpriteProps.y=this.currentSpriteProps.iY*this.options.frames.height,this.ctx.drawImage(this.spritesheet,this.currentSpriteProps.x,this.currentSpriteProps.y,this.options.frames.width,this.options.frames.height,this.x,this.y,this.options.frames.width*this.scale,this.options.frames.height*this.scale)},setDirection:function(direction){this.direction=direction===LightSpritesheet.FORWARD?1:-1},handleSpritesheetLoaded:function(){}};
